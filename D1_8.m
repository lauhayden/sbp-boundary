% 1st derivative, p=4 SBP operator
% From SBP SAT Review paper

function [H,D1]=D1_8(n,q16,q17,q47)
% optimized value comment out to use other values
q16 = 0.08314829949122060462305047907908720666335d0;
q17 = -0.9521334029619388274601963790830716099197d-2;
q47 = -0.3510216710115618609017136924794334791187d-1;
h11 = 0.1498139d7 / 0.5080320d7; h22 = 0.1107307d7 / 0.725760d6;
h33 = 0.20761d5 / 0.80640d5; h44 = 0.1304999d7 / 0.725760d6;
h55 = 0.299527d6 / 0.725760d6; h66 = 0.103097d6 / 0.80640d5;
h77 = 0.670091d6 / 0.725760d6; h88 = 0.5127739d7 / 0.5080320d7;
q11 = -1.d0/2.d0;
q12 = 0.59065123d8 / 0.91445760d8 + q16 / 0.3d1 + 0.2d1 / 0.3d1 * q17;
q13 = 0.771343d6 / 0.10160640d8 - 0.8d1 / 0.5d1 * q16 - 0.3d1 * q17;
q14 = -0.8276887d7 / 0.20321280d8 + (3.d0 * q16) + (5.d0 * q17);
q15 = 0.17658817d8 / 0.91445760d8 - 0.8d1 / 0.3d1 * q16 - 0.10d2 / 0.3d1 * q17;
q18 = -0.1394311d7 / 0.182891520d9 - q16 / 0.15d2 - q17 / 0.3d1;
q23 = q47 / 0.45d2 + 0.14d2 / 0.3d1 * q16 + 0.77d2 / 0.9d1 * q17 - 0.14866699d8 / 0.130636800d9;
q24 = 0.18734719d8 / 0.13063680d8 - 0.35d2 / 0.3d1 * q16 - 0.175d3 / 0.9d1 * q17 - q47 / 0.9d1;
q25 = -0.2642179d7 / 0.3265920d7 + 0.35d2 / 0.3d1 * q16 + 0.140d3 / 0.9d1 * q17 + 0.2d1 / 0.9d1 * q47;
q26 = 0.1736509d7 / 0.13063680d8 - 0.14d2 / 0.3d1 * q16 - 0.14d2 / 0.9d1 * q17 - 0.2d1 / 0.9d1 * q47;
q27 = -0.13219d5 / 0.1244160d7 - 0.35d2 / 0.9d1 * q17 + q47 / 0.9d1;
q28 = 0.1407281d7 / 0.114307200d9 + q16 / 0.3d1 + 0.13d2 / 0.9d1 * q17 - q47 / 0.45d2;
q34 = -0.3056891d7 / 0.4354560d7 + (14.d0 * q16) + 0.70d2 / 0.3d1 * q17 + q47 / 0.3d1;
q35 = 0.765701d6 / 0.653184d6 - 0.56d2 / 0.3d1 * q16 - 0.245d3 / 0.9d1 * q17 - 0.8d1 / 0.9d1 * q47;
q36 = -0.238939d6 / 0.414720d6 + 0.42d2 / 0.5d1 * q16 + 0.7d1 * q17 + q47;
q37 = 0.754291d6 / 0.21772800d8 + 0.14d2 / 0.3d1 * q17 - 0.8d1 / 0.15d2 * q47;
q38 = 0.762499d6 / 0.22861440d8 - 0.2d1 / 0.3d1 * q16 - 0.20d2 / 0.9d1 * q17 + q47 / 0.9d1;
q45 = -0.10064459d8 / 0.26127360d8 + 0.35d2 / 0.3d1 * q16 + 0.175d3 / 0.9d1 * q17 + 0.10d2 / 0.9d1 * q47;
q46 = 0.62249d5 / 0.77760d5 - (7.d0 * q16) - 0.35d2 / 0.3d1 * q17 - 0.5d1 / 0.3d1 * q47;
q48 = -0.8276887d7 / 0.91445760d8 + 0.2d1 / 0.3d1 * q16 + 0.10d2 / 0.9d1 * q17 - 0.2d1 / 0.9d1 * q47;
q56 = 0.792095d6 / 0.2612736d7 + 0.7d1 / 0.3e1 * q16 + 0.70d2 / 0.9d1 * q17 + 0.10d2 / 0.9d1 * q47;
q57 = -0.42403d5 / 0.207360d6 - 0.35d2 / 0.9d1 * q17 - 0.8d1 / 0.9d1 * q47;
q58 = 0.13906657d8 / 0.182891520d9 - q16 / 0.3d1 + 0.5d1 / 0.9d1 * q17 + 0.2d1 / 0.9d1 * q47;
q59 = -1.d0/280.d0;
q67 = 0.1360207d7 / 0.1741824d7 + 0.7d1 / 0.3d1 * q17 + q47 / 0.3d1;
q68 = -0.289189d6 / 0.1866240d7 + q16 / 0.15d2 - 0.7d1 / 0.9d1 * q17 - q47 / 0.9d1;
q69 = 4.d0/105.d0; q610 = -1.d0/280.d0;
q78 = 0.16676111d8 / 0.21772800d8 + 0.2d1 / 0.9d1 * q17 + q47 / 0.45d2;
q79 = -1.d0/5.d0; q710 = 4.d0/105.d0;q711 = -1.d0/280.d0; q89 = 4.d0/5.d0;
q810 = -1.d0/5.d0; q811 = 4.d0/105.d0; q812 = -1.d0/280.d0;
%setting up H and D1
H = eye(n,n);
H(1,1) = h11;H(n,n) = h11;H(2,2) = h22;H(n-1,n-1) = h22;H(3,3) = h33;H(n-2,n-2) = h33;
H(4,4) = h44;H(n-3,n-3) = h44;H(5,5) = h55;H(n-4,n-4) = h55;H(6,6) = h66;H(n-5,n-5) = h66;
H(7,7) = h77;H(n-6,n-6) = h77;H(8,8) = h88;H(n-7,n-7) = h88;
Q = zeros(n,n);
Q(1,1) = q11;Q(1,2) = q12;Q(1,3) = q13; Q(1,4) = q14;Q(1,5) = q15; Q(1,6) = q16;
Q(1,7) = q17; Q(1,8) = q18;Q(2,1) = -q12; Q(2,3) = q23; Q(2,4) = q24; Q(2,5) = q25;
Q(2,6) = q26; Q(2,7) = q27;Q(2,8) = q28;Q(3,1) = -q13;Q(3,2) = -q23;
Q(3,4) = q34; Q(3,5) = q35;Q(3,6) = q36; Q(3,7) = q37;Q(3,8) = q38;
Q(4,1) = -q14;Q(4,2) = -q24;Q(4,3) = -q34; Q(4,5) = q45;Q(4,6) = q46; Q(4,7) = q47;
Q(4,8) = q48;Q(5,1) = -q15; Q(5,2) = -q25;Q(5,3) = -q35; Q(5,4) = -q45;
Q(5,6) = q56; Q(5,7) = q57;Q(5,8) = q58; Q(5,9) = q59;Q(6,1) = -q16; Q(6,2) = -q26;
Q(6,3) = -q36; Q(6,4) = -q46;Q(6,5) = -q56; Q(6,7) = q67;Q(6,8) = q68; Q(6,9) = q69;
Q(6,10) = q610;Q(7,1) = -q17; Q(7,2) = -q27;Q(7,3) = -q37; Q(7,4) = -q47;
Q(7,5) = -q57; Q(7,6) = -q67;Q(7,8) = q78; Q(7,9) = q79;Q(7,10) = q710; Q(7,11) = q711;
Q(8,1) = -q18; Q(8,2) = -q28;Q(8,3) = -q38; Q(8,4) = -q48;Q(8,5) = -q58; Q(8,6) = -q68;
Q(8,7) = -q78; Q(8,9) = q89;Q(8,10) = q810; Q(8,11) = q811;Q(8,12) = q812;

%internal nodes
for i =9:n-8
    Q(i,i-4:i+4) = ...
    [1.d0/280.d0, -4.d0/105.d0, 1.d0/5.d0, -4.d0/5.d0, 0.d0, 4.d0/5.d0, -1.d0/5.d0, 4.d0/105.d0, -1.d0/280.d0];
end

%bottom portion of the matrix
for i = 1:12
    for j = 1:12
        Q(n-(i-1),n-(j-1)) = -Q(i,j);
    end
end
D1 = inv(H)*Q;